#!/bin/bash
# Set timestamp-based version across all config files
# Usage: ./scripts/set-version [version]
# If no version provided, uses current timestamp (YYMMDD.HHMM)

set -e

if [ -z "$1" ]; then
    # Generate timestamp version (0.YYMMDD.HHMM format for semver compatibility)
    VERSION="0.$(date +"%y%m%d.%H%M")"
else
    VERSION="$1"
fi

echo "ðŸ“… Setting version to: $VERSION"

# Update package.json version
if [[ "$OSTYPE" == "darwin"* ]]; then
    sed -i '' "s/\"version\": \"[^\"]*\"/\"version\": \"$VERSION\"/" package.json
else
    sed -i "s/\"version\": \"[^\"]*\"/\"version\": \"$VERSION\"/" package.json
fi
echo "âœ“ Updated package.json"

# Update Cargo.toml version
if [[ "$OSTYPE" == "darwin"* ]]; then
    sed -i '' "s/^version = \"[^\"]*\"/version = \"$VERSION\"/" src-tauri/Cargo.toml
else
    sed -i "s/^version = \"[^\"]*\"/version = \"$VERSION\"/" src-tauri/Cargo.toml
fi
echo "âœ“ Updated Cargo.toml"

# Update tauri.conf.json version
if [[ "$OSTYPE" == "darwin"* ]]; then
    sed -i '' "s/\"version\": \"[^\"]*\"/\"version\": \"$VERSION\"/" src-tauri/tauri.conf.json
else
    sed -i "s/\"version\": \"[^\"]*\"/\"version\": \"$VERSION\"/" src-tauri/tauri.conf.json
fi
echo "âœ“ Updated tauri.conf.json"

# Create/update version.json for frontend access
TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")
echo "{ \"version\": \"$VERSION\", \"timestamp\": \"$TIMESTAMP\" }" > public/version.json
echo "âœ“ Updated public/version.json"

echo ""
echo "âœ… Version set to $VERSION"
